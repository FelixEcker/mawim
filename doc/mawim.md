# MaWiM documentation
## Dependencies
* Xlib
* glibc

## Usage
**Synposis:** `mawim [--config=CONFIG_PATH] [--verbosity=VERBOSITY_LEVEL]`

**NOTE: the `--config` argument is not implemented!**

### Environment Variables
* `MAWIMCTL_SOCK` Specifies the location for the mawimctl socket in the filesystem.

## Building
MaWiM requires [mariebuild](https://github.com/FelixEcker/mariebuild) 0.5.1 or higher to build.

### Output
All files generated by building are found in `build/`. This directory has the following structure
* `obj/` - Contains object files generated whilst compiling
* `release/` - Contains the linked binaries for release mode
* `debug/` - Contains the linked binaries for debug mode

### Targets
* release
    * runs target mawimctl-release
    * builds mawimctl in release mode
* debug
    * builds MaWiM in debug mode
* mawimctl-release
    * builds mawimctl in release mode (see mawimctl/build.mb)
* mawimctl-debug
    * builds mawimctl in debug mode (see mawimctl/build.mb)

## Debugging
MaWiM provides the `run.bash` script to be used for debugging using Xephyr. It has options to automatically rebuild
MaWiM, run it wrapped in valgrind or attach gdb ~5 seconds after launch.

This script requires [argtest](https://github.com/FelixEcker/argtest) to function.

### Environment Variables
* MARIEBUILD_FLAGS (can be set externally)
    * Flags to be postfixed to any mariebuild command run in `run.bash`
* XEPHYR_RESOLUTION
    * Sets the resolution Xephyr should start in
* XEPHYR_DISPLAY
    * Sets the display which Xephyr should use

### Flags
* `--help` or `-?`
    * Provides a short overview of viable arguments
* `--rebuild`
    * Rebuilds MaWiM before launching
* `--release`
    * Uses a release build instead of a debug build. Rebuilds if no binary is present
* `--gdb`
    * Attaches gdb to the MaWiM process ~5 seconds after launch
* `--valgrind`
    * Runs MaWiM wrapped in valgrind

## Source Structure
This section is in no way intended to be comprehensive documentaion about how MaWiM or mawimctl functions, rather it is a quick overview of what does what.

* `/`
    * `build.mb` - General MaWiM build file. Can also build mawimctl
    * `data/` - Data for debugging MaWiM
    * `include/` - Header files which were not directly written for MaWiM
    * `src/` - MaWiM implementation
        * `commands.h/c` - mawimctl command handling
        * `error.h/c` - X11 error handling and MaWiM panicking
        * `events.h/c` - X11 event handling
        * `logging.h/c` - MaWiM logger
        * `mawim.h/c` - Main entry point and shared X11 functions
        * `mawimctl_server.h/c` - mawimctl server implementation
        * `types.h` - Shared type definitions
        * `window.h/c` - Window Managing
        * `xmem.h/c` - Memory management utils.
    * `mawimctl/`
        * `build.mb` - mawimctl client build file
        * `mawimctl.h` - Common mawimctl definitions
        * `src/`
            * `main.c` - Main entrypoint for the mawimctl client
            * `mawimctl_client.h/c` - mawimctl client implementation
